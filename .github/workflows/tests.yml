name: ğŸ§¹ Tests

on:
  pull_request:
  push:

jobs:
  linter:
    name: ğŸ§¹ SwiftLint
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/realm/swiftlint:latest

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: ğŸ§¹ SwiftLint
      run: swiftlint --reporter github-actions-logging --strict

  build:
    name: ğŸ—ï¸ Build
    runs-on: macos-14

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: ğŸ› ï¸ Set up Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest

    - name: ğŸ’¾ Cache DerivedData
      uses: actions/cache@v4
      with:
        path: ~/Library/Developer/Xcode/DerivedData
        key: ${{ runner.os }}-xcode-deriveddata-${{ hashFiles('**/*.pbxproj', '**/*.swift') }}
        restore-keys: |
          ${{ runner.os }}-xcode-deriveddata-

    - name: ğŸ—ï¸ Build Fruit.saver
      run: xcodebuild -scheme Fruit -configuration Debug build | tail -20

    - name: ğŸ—ï¸ Build FruitShop
      run: xcodebuild -scheme FruitShop -configuration Debug build | tail -20
